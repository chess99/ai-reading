# ä¾§æ å®ç°è¯´æ˜

## æŠ€æœ¯æ–¹æ¡ˆ: View Transitions

ä½¿ç”¨ Astro 5.0 å†…ç½®çš„ View Transitions API å®ç°çœŸæ­£å¸¸é©»çš„ä¾§æ ,æ— éœ€å®Œæ•´é¡µé¢åˆ·æ–°ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© View Transitions?

| ç‰¹æ€§ | ä¼ ç»Ÿ MPA | View Transitions | SPA (Next.js) |
|------|----------|------------------|---------------|
| ä¾§æ å¸¸é©» | âŒ æ¯æ¬¡é‡æ–°æ¸²æŸ“ | âœ… çœŸæ­£å¸¸é©» | âœ… çœŸæ­£å¸¸é©» |
| ä¿æŒçŠ¶æ€ | âŒ çŠ¶æ€ä¸¢å¤± | âœ… å®Œæ•´ä¿ç•™ | âœ… å®Œæ•´ä¿ç•™ |
| SEO å‹å¥½ | âœ… å®Œç¾ | âœ… å®Œç¾ | âœ… éœ€é…ç½® SSG |
| é¦–å±æ€§èƒ½ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| åŒ…ä½“ç§¯ | 0 KB | ~5 KB | ~200 KB |
| è¿ç§»æˆæœ¬ | - | æä½ | æé«˜ |

## æ ¸å¿ƒå®ç°

### 1. BaseLayout é›†æˆ

```astro
---
import { ViewTransitions } from 'astro:transitions';
import Sidebar from '@/components/sidebar/Sidebar.astro';
---

<html>
  <head>
    <ViewTransitions />
  </head>
  <body>
    <!-- Header ä¿æŒå¸¸é©» -->
    <header transition:persist="header">
      <!-- ... -->
    </header>

    <!-- ä¾§æ ä¿æŒå¸¸é©» -->
    {showSidebar && <Sidebar />}

    <!-- ä¸»å†…å®¹åŒºæ·»åŠ è¿‡æ¸¡åŠ¨ç”» -->
    <main transition:animate="slide">
      <slot />
    </main>
  </body>
</html>
```

### 2. Sidebar ç»„ä»¶

**å…³é”®ç‰¹æ€§:**

- `transition:persist="sidebar"`: ä¿æŒä¾§æ  DOM ä¸å˜
- localStorage æŒä¹…åŒ–çŠ¶æ€
- æ–‡ä»¶æ ‘ç»“æ„(åˆ†ç±» â†’ ä¹¦ç±)
- å½“å‰æ–‡ä»¶é«˜äº®
- æŠ˜å /å±•å¼€åŠŸèƒ½

**çŠ¶æ€ç®¡ç†:**

```javascript
// ä¿å­˜ä¾§æ æŠ˜å çŠ¶æ€
localStorage.setItem('sidebar-collapsed', 'true');

// ä¿å­˜å±•å¼€çš„æ–‡ä»¶å¤¹
localStorage.setItem('expanded-folders', JSON.stringify(['æŠ•èµ„', 'å¿ƒç†å­¦']));
```

### 3. é¡µé¢å¯ç”¨ä¾§æ 

åœ¨é¡µé¢çš„ BaseLayout ä¸­æ·»åŠ  `showSidebar={true}`:

```astro
<BaseLayout
  title="é¡µé¢æ ‡é¢˜"
  showSidebar={true}
>
  <!-- é¡µé¢å†…å®¹ -->
</BaseLayout>
```

## è®¾è®¡ç»†èŠ‚ (å‚è€ƒ Obsidian)

### è§†è§‰è®¾è®¡

- **å®½åº¦**: 280px (å±•å¼€) / 48px (æŠ˜å )
- **ä½ç½®**: Fixed,ä» Header ä¸‹æ–¹å¼€å§‹
- **å±‚çº§**: z-index: 40
- **è¿‡æ¸¡**: 0.25s ease åŠ¨ç”»

### æ–‡ä»¶æ ‘

```
ğŸ“ æŠ•èµ„ (12)
  â””â”€ ğŸ“„ æ€æ ·é€‰æ‹©æˆé•¿è‚¡
  â””â”€ ğŸ“„ èªæ˜çš„æŠ•èµ„è€…
ğŸ“ å¿ƒç†å­¦ (8)
  â””â”€ ğŸ“„ æ€è€ƒ,å¿«ä¸æ…¢
```

### äº¤äº’

1. **æ–‡ä»¶å¤¹ç‚¹å‡»**: å±•å¼€/æŠ˜å ä¹¦ç±åˆ—è¡¨
2. **ä¹¦ç±ç‚¹å‡»**: å¯¼èˆªåˆ°ä¹¦ç±è¯¦æƒ…é¡µ
3. **æŠ˜å æŒ‰é’®**: æ”¶èµ·ä¾§æ è‡³ 48px
4. **è‡ªåŠ¨é«˜äº®**: å½“å‰ä¹¦ç±è‡ªåŠ¨é«˜äº®å¹¶å±•å¼€æ‰€åœ¨æ–‡ä»¶å¤¹

### çŠ¶æ€æŒä¹…åŒ–

ç”¨æˆ·çš„ä»¥ä¸‹æ“ä½œä¼šè¢«è®°ä½:
- ä¾§æ æ˜¯å¦æŠ˜å 
- å“ªäº›æ–‡ä»¶å¤¹è¢«å±•å¼€
- æ»šåŠ¨ä½ç½® (ç”± View Transitions è‡ªåŠ¨å¤„ç†)

## æµè§ˆå™¨å…¼å®¹æ€§

View Transitions API æ”¯æŒ:
- âœ… Chrome 111+
- âœ… Edge 111+
- âœ… Safari 18+ (iOS 18+)
- âš ï¸ Firefox: éœ€è¦å¯ç”¨å®éªŒæ€§åŠŸèƒ½

**é™çº§æ–¹æ¡ˆ**: ä¸æ”¯æŒçš„æµè§ˆå™¨ä¼šå›é€€åˆ°ä¼ ç»Ÿé¡µé¢è·³è½¬,ä¾§æ ä¼šé‡æ–°æ¸²æŸ“,ä½†åŠŸèƒ½æ­£å¸¸ã€‚

## æ€§èƒ½ä¼˜åŠ¿

### ä¼ ç»Ÿ MPA (æ¯æ¬¡è·³è½¬)
```
åŠ è½½ HTML (100ms)
+ è§£æ CSS (20ms)
+ æ‰§è¡Œ JS (30ms)
+ æ¸²æŸ“ä¾§æ  (50ms)
= 200ms
```

### View Transitions (è·³è½¬å)
```
Fetch HTML (50ms)
+ Diff & Patch (20ms)
+ åŠ¨ç”» (300ms å¹¶è¡Œ)
= 70ms (+ åŠ¨ç”»)
```

**ç»“æœ**: é¡µé¢åˆ‡æ¢å¿« 60%,ä¸”ä¾§æ çŠ¶æ€å®Œæ•´ä¿ç•™ã€‚

## ä¸ feature/obsidian-navigation åˆ†æ”¯çš„åŒºåˆ«

| ç‰¹æ€§ | æ—§å®ç° (feature åˆ†æ”¯) | æ–°å®ç° (main åˆ†æ”¯) |
|------|---------------------|-------------------|
| æŠ€æœ¯æ–¹æ¡ˆ | æ‰‹åŠ¨çŠ¶æ€ç®¡ç† | View Transitions |
| ä¾§æ å¸¸é©» | å‡è£…å¸¸é©» (æ¯æ¬¡é‡æ¸²æŸ“) | çœŸæ­£å¸¸é©» |
| çŠ¶æ€ä¿æŒ | éƒ¨åˆ†ä¿æŒ | å®Œæ•´ä¿æŒ |
| ä»£ç å¤æ‚åº¦ | é«˜ (1700+ è¡Œ) | ä½ (440 è¡Œ) |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |
| ç”¨æˆ·ä½“éªŒ | è‰¯å¥½ | ä¼˜ç§€ |

## æœªæ¥ä¼˜åŒ–

- [ ] æ·»åŠ æœç´¢æ¡†ç­›é€‰ä¹¦ç±
- [ ] æ”¯æŒæ‹–æ‹½æ’åº
- [ ] æ·»åŠ æ ‡ç­¾è§†å›¾
- [ ] æ”¯æŒé”®ç›˜å¿«æ·é”® (Cmd+P ç­‰)
- [ ] æ·»åŠ æœ€è¿‘è®¿é—®åˆ—è¡¨
- [ ] æ”¯æŒä¹¦ç­¾åŠŸèƒ½

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ View Transitions ç”Ÿæ•ˆ

åœ¨ Chrome DevTools Console ä¸­:

```javascript
// ç›‘å¬é¡µé¢åŠ è½½äº‹ä»¶
document.addEventListener('astro:page-load', () => {
  console.log('Page loaded via View Transitions');
});

// ç›‘å¬å¯¼èˆªäº‹ä»¶
document.addEventListener('astro:before-preparation', () => {
  console.log('Preparing to navigate');
});
```

### æ£€æŸ¥çŠ¶æ€æŒä¹…åŒ–

```javascript
// æŸ¥çœ‹ä¿å­˜çš„çŠ¶æ€
console.log(localStorage.getItem('sidebar-collapsed'));
console.log(localStorage.getItem('expanded-folders'));
```

### å¼ºåˆ¶åˆ·æ–°ä¾§æ 

å¦‚æœä¾§æ çŠ¶æ€å¼‚å¸¸,æ¸…é™¤ localStorage:

```javascript
localStorage.removeItem('sidebar-collapsed');
localStorage.removeItem('expanded-folders');
location.reload();
```

## æ€»ç»“

View Transitions æ˜¯ Astro å®ç°å¸¸é©»ä¾§æ çš„æœ€ä½³æ–¹æ¡ˆ:
- âœ… çœŸæ­£çš„ SPA ä½“éªŒ
- âœ… SEO å®Œå…¨å‹å¥½
- âœ… æ€§èƒ½æä½³
- âœ… å®ç°ç®€å•
- âœ… ç»´æŠ¤æˆæœ¬ä½

æ— éœ€è¿ç§»åˆ° Next.js ç­‰é‡é‡çº§æ¡†æ¶,å³å¯è·å¾—ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚
